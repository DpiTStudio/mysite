# Инструкции по настройке системы регистрации, авторизации и тикетов

## Важно: Проблема с миграциями

После добавления кастомной модели пользователя (`AUTH_USER_MODEL = "accounts.User"`), необходимо пересоздать базу данных, так как существующая база данных была создана с использованием стандартной модели User Django.

## Шаги для настройки:

1. **Удалите существующую базу данных** (если это допустимо в вашем случае):
   ```bash
   del db.sqlite3
   ```

2. **Удалите все миграции** (кроме __init__.py):
   ```bash
   # Удалите файлы миграций в папках:
   # - accounts/migrations/ (кроме __init__.py)
   # - tickets/migrations/ (кроме __init__.py)
   # - main/migrations/ (кроме __init__.py)
   # - news/migrations/ (кроме __init__.py)
   # - portfolio/migrations/ (кроме __init__.py)
   # - reviews/migrations/ (кроме __init__.py)
   # - logfiles/migrations/ (кроме __init__.py)
   ```

3. **Создайте миграции заново**:
   ```bash
   python manage.py makemigrations
   ```

4. **Примените миграции**:
   ```bash
   python manage.py migrate
   ```

5. **Создайте суперпользователя**:
   ```bash
   python manage.py createsuperuser
   ```

## Альтернативный вариант (если нельзя удалять базу данных):

Если у вас уже есть важные данные в базе, используйте следующий подход:

1. **Пометьте миграцию accounts как примененную**:
   ```bash
   python manage.py migrate accounts 0001_initial --fake
   ```

2. **Создайте и примените миграции для tickets**:
   ```bash
   python manage.py migrate tickets
   ```

3. **Создайте таблицу для новой модели User вручную** или используйте `python manage.py migrate accounts --fake-initial`

## Что было добавлено:

### 1. Приложение accounts (Регистрация и авторизация)
- Модель User с дополнительными полями (phone, avatar)
- Формы регистрации и входа с капчей
- Представления для регистрации, входа, выхода и профиля
- Личный кабинет с навигацией

### 2. Приложение tickets (Система тикетов)
- Модели Ticket и TicketMessage
- Формы создания тикета с капчей
- Представления для списка, создания, детального просмотра и закрытия тикетов
- Полнофункциональный интерфейс для работы с тикетами

### 3. Капча добавлена во все формы:
- Регистрация пользователя
- Вход в систему
- Создание отзыва
- Создание тикета

### 4. Навигация:
- Зафиксирована навигация (fixed-top)
- Добавлены ссылки на регистрацию/вход/личный кабинет
- Добавлено выпадающее меню для авторизованных пользователей

### 5. Личный кабинет:
- Редактирование профиля
- Просмотр и управление тикетами
- Навигационное меню в боковой панели

## URL-маршруты:

- `/accounts/register/` - Регистрация
- `/accounts/login/` - Вход
- `/accounts/logout/` - Выход
- `/accounts/profile/` - Личный кабинет
- `/tickets/` - Список тикетов
- `/tickets/create/` - Создание тикета
- `/tickets/<id>/` - Детальный просмотр тикета
- `/tickets/<id>/close/` - Закрытие тикета

## Настройки в settings.py:

- Добавлено `captcha` в INSTALLED_APPS
- Добавлено `accounts` в INSTALLED_APPS
- Добавлено `tickets` в INSTALLED_APPS
- Установлено `AUTH_USER_MODEL = "accounts.User"`
- Добавлены настройки капчи

## Требования:

Все необходимые пакеты уже указаны в requirements.txt:
- django-simple-captcha==0.6.3

Убедитесь, что установлены все зависимости:
```bash
pip install -r requirements.txt
```

