# Документация приложения Accounts

Приложение `accounts` отвечает за управление пользователями, аутентификацию, регистрацию и профили пользователей на сайте.

## Обзор
Это приложение расширяет стандартную модель пользователя Django, добавляя дополнительные поля (телефон, аватар) и предоставляет функционал для:
- Регистрации пользователей (с капчей)
- Входа в систему (с капчей)
- Выхода из системы
- Просмотра и редактирования личного кабинета

---

## Описание файлов

### 1. `admin.py`
Файл конфигурации административной панели для модели пользователя.

**Классы:**
- `UserAdmin(BaseUserAdmin)`: Наследуется от стандартного `BaseUserAdmin` для настройки отображения пользователей в админке.
    - `list_display`: Определяет поля, видимые в списке пользователей: имя пользователя, email, телефон, имя, фамилия, статус персонала, дата создания.
    - `list_filter`: Добавляет фильтры справа: персонал, суперпользователь, активен, дата создания.
    - `search_fields`: Позволяет искать по имени пользователя, email, телефону, имени и фамилии.
    - `readonly_fields`: Поля только для чтения: дата создания, дата обновления, дата регистрации, последний вход.
    - `fieldsets`: Расширяет стандартные секции формы редактирования, добавляя секцию "Дополнительная информация" с полями `phone` (телефон), `avatar` (аватар), `created_at` (создан), `updated_at` (обновлен).

**Регистрация:**
- `@admin.register(User)`: Декоратор, который регистрирует модель `User` с настройками `UserAdmin` в административной панели.

### 2. `apps.py`
Файл конфигурации приложения.

**Классы:**
- `AccountsConfig(AppConfig)`:
    - `default_auto_field`: Устанавливает тип первичного ключа по умолчанию (`django.db.models.BigAutoField`).
    - `name`: Указывает имя приложения (`accounts`).
    - `verbose_name`: Указывает человекочитаемое имя приложения в админке ("Пользователи").
    - `verbose_name_plural`: Множественное число имени ("Пользователи").

### 3. `forms.py`
Файл содержит Django-формы для обработки пользовательского ввода.

**Классы:**

#### `UserRegistrationForm(UserCreationForm)`
Форма регистрации нового пользователя.
- **Поля:**
    - `email`: Обязательное поле Email с виджетом `EmailInput` (CSS класс `form-control`).
    - `phone`: Необязательное поле телефона (макс. 20 символов) с виджетом `TextInput`.
    - `captcha`: Поле для ввода капчи для защиты от ботов. (Требует настройки `django-simple-captcha`).
- **Meta:**
    - `model`: Связана с моделью `User`.
    - `fields`: Включает поля `username`, `email`, `phone`, `password1` (пароль), `password2` (подтверждение).
    - `widgets`: Настройка виджета для `username` с CSS классом `form-control`.

#### `UserLoginForm(AuthenticationForm)`
Форма входа в систему.
- **Поля:**
    - `captcha`: Добавляет обязательное поле капчи при входе.

#### `UserProfileForm(forms.ModelForm)`
Форма редактирования профиля пользователя.
- **Meta:**
    - `model`: Связана с моделью `User`.
    - `fields`: Позволяет редактировать имя, фамилию, email, телефон и аватар.
    - `widgets`: Применяет CSS класс `form-control` ко всем полям для единого стиля.

### 4. `models.py`
Файл определения структуры базы данных (моделей).

**Классы:**

#### `User(AbstractUser, TimestampModel)`
Кастомная модель пользователя, наследующая стандартную `AbstractUser` и абстрактную `TimestampModel` (из приложения main).
- **Поля:**
    - Наследует все стандартные поля (username, password, email, first_name, last_name, и т.д.).
    - `phone`: Текстовое поле для телефона (макс. 20 символов), может быть пустым.
    - `avatar`: Поле изображения. Использует утилиту `RenameUploadTo` для сохранения файлов в папку `avatars/` с переименованием. Может быть пустым.
    - *От TimestampModel*: `created_at` (дата создания) и `updated_at` (дата обновления).

### 5. `urls.py`
Файл маршрутизации URL для приложения.

- `app_name = "accounts"`: Пространство имен для URL.
- **Маршруты (`urlpatterns`):**
    - `/register/` -> `views.register_view`: Страница регистрации.
    - `/login/` -> `views.login_view`: Страница входа.
    - `/logout/` -> `views.logout_view`: Действие выхода.
    - `/profile/` -> `views.profile_view`: Страница личного кабинета.

### 6. `views.py`
Файл логики представлений (контроллеров).

#### `register_view(request)`
Обрабатывает регистрацию пользователей.

#### `login_view(request)`
Обрабатывает вход пользователей.

#### `logout_view(request)`
Обрабатывает выход.

#### `profile_view(request)`
Отображает и обновляет профиль пользователя.

## Особенности реализации

1. **Расширенная модель пользователя**: Использует множественное наследование от `AbstractUser` и `TimestampModel` для добавления временных меток.
2. **Защита капчей**: Все публичные формы (регистрация, вход) защищены капчей для предотвращения автоматической регистрации ботов.
3. **Автоматическое переименование файлов**: Аватары пользователей сохраняются с использованием утилиты `RenameUploadTo`, которая создает уникальные имена файлов на основе заголовка и даты загрузки.
4. **Bootstrap стилизация**: Все формы используют CSS класс `form-control` для единообразного внешнего вида.
