"""
Модуль models.py приложения accounts

Этот файл определяет кастомную модель пользователя для системы DPIT-CMS.
Модель расширяет стандартную модель пользователя Django, добавляя дополнительные поля
для хранения контактной информации и аватара пользователя.
"""

# Импорт базовых классов Django для работы с моделями
from django.db import models
# Импорт абстрактной модели пользователя Django для наследования
from django.contrib.auth.models import AbstractUser
# Импорт утилиты для автоматического переименования загружаемых файлов
from main.utils import RenameUploadTo
# Импорт абстрактной модели с полями created_at и updated_at
from main.models import TimestampModel


class User(AbstractUser, TimestampModel):
    """
    Расширенная модель пользователя системы DPIT-CMS.
    
    Наследуется от AbstractUser (стандартная модель пользователя Django) и TimestampModel
    (добавляет поля created_at и updated_at для отслеживания времени создания и обновления).
    
    Дополнительные поля по сравнению со стандартной моделью:
    - phone: Номер телефона пользователя
    - avatar: Аватар пользователя (изображение)
    
    Все стандартные поля AbstractUser также доступны:
    - username: Имя пользователя (уникальное)
    - email: Электронная почта
    - first_name: Имя
    - last_name: Фамилия
    - password: Хешированный пароль
    - is_staff: Флаг персонала (доступ к админке)
    - is_superuser: Флаг суперпользователя
    - is_active: Флаг активности аккаунта
    - date_joined: Дата регистрации
    - last_login: Дата последнего входа
    """
    
    # Поле для хранения номера телефона пользователя
    # max_length=20: Максимальная длина строки (достаточно для международных форматов)
    # blank=True: Поле может быть пустым при заполнении формы
    # verbose_name: Человекочитаемое название поля для админки
    phone = models.CharField(max_length=20, blank=True, verbose_name="Телефон")
    
    # Поле для загрузки аватара пользователя
    # upload_to: Использует утилиту RenameUploadTo для автоматического переименования файлов
    #   Формат имени файла: "avatars/username_2023-01-01_12-00-00.jpg"
    # blank=True, null=True: Поле необязательное, может быть пустым
    # verbose_name: Название поля в админке
    avatar = models.ImageField(upload_to=RenameUploadTo("avatars/"), blank=True, null=True, verbose_name="Аватар")
    
    class Meta:
        """
        Класс Meta для настройки метаданных модели.
        
        Определяет поведение модели в админке Django и при работе с ORM.
        """
        # Человекочитаемое название модели в единственном числе (для админки)
        verbose_name = "Пользователь"
        # Человекочитаемое название модели во множественном числе
        verbose_name_plural = "Пользователи"
        # Порядок сортировки по умолчанию: сначала новые пользователи (по убыванию даты создания)
        # Знак минус перед полем означает сортировку по убыванию
        ordering = ["-created_at"]
    
    def __str__(self):
        """
        Метод строкового представления объекта.
        
        Возвращает имя пользователя при преобразовании объекта в строку.
        Используется в админке Django для отображения записей в списках и выпадающих меню.
        
        Returns:
            str: Имя пользователя (username)
        """
        return self.username
