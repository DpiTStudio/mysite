{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
    .home-section {
        padding: 5rem 0;
    }
    .section-title {
        text-align: center;
        margin-bottom: 4rem;
        position: relative;
    }
    .section-title::after {
        content: '';
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 4px;
        background: var(--gradient-premium);
        border-radius: 2px;
    }
    .feature-icon-box {
        width: 80px;
        height: 80px;
        background: var(--color-glass);
        border: 1px solid var(--color-glass-border);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: var(--color-primary);
        margin-bottom: 1.5rem;
        transition: var(--transition-normal);
    }
    .service-card:hover .feature-icon-box {
        background: var(--color-primary);
        color: #fff;
        transform: rotateY(360deg);
    }
    .review-card {
        border-left: 4px solid var(--color-primary);
    }
</style>
{% endblock %}

{% block content %}
    <!-- Секция приветствия (если есть в настройках) -->
    {% if site_settings.content %}
    <section class="home-section animate-up animate-active">
        <div class="glass-card-premium p-5 shadow-lg">
            <div class="site_content">
                {{ site_settings.content|safe }}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Популярные услуги -->
    {% if popular_services %}
    <section class="home-section">
        <div class="section-title animate-up">
            <h2 class="display-5 text-gradient">Наши Услуги</h2>
            <p class="text-muted">Решения любой сложности для вашего бизнеса</p>
        </div>
        <div class="row g-4">
            {% for service in popular_services %}
            <div class="col-md-6 col-xl-3 animate-up delay-{{ forloop.counter }}00">
                <div class="glass-card-premium p-4 service-card h-100">
                    <div class="feature-icon-box float-animation">
                        {% if service.icon %}
                            <img src="{{ service.icon.url }}" alt="{{ service.title }}" width="40">
                        {% else %}
                            <i class="bi bi-gear-wide-connected"></i>
                        {% endif %}
                    </div>
                    <h4 class="h5">{{ service.title }}</h4>
                    <p class="small text-muted">{{ service.short_description|striptags|truncatewords:20 }}</p>
                    <div class="mt-auto">
                        <span class="badge bg-primary mb-3">{{ service.get_price_display }}</span>
                        <div class="d-flex gap-2">
                             <a href="{% url 'services:list' %}" class="btn btn-sm btn-outline-primary w-100">Подробнее</a>
                             <form hx-post="{% url 'cart:cart_add' service.id %}" hx-target="#cart-offcanvas-body" hx-swap="innerHTML" class="w-100" onclick="new bootstrap.Offcanvas(document.getElementById('cartOffcanvas')).show()">
                                 {% csrf_token %}
                                 <button type="submit" class="btn btn-sm btn-success w-100">
                                     <i class="bi bi-cart-plus"></i> В корзину
                                 </button>
                             </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-5 animate-up">
            <a href="{% url 'services:list' %}" class="btn btn-primary px-5">Показать все услуги <i class="bi bi-arrow-right"></i></a>
        </div>
    </section>
    {% endif %}

    <!-- Последние работы портфолио -->
    {% if latest_portfolio %}
    <section class="home-section">
        <div class="section-title animate-up">
            <h2 class="display-5 text-gradient">Портфолио</h2>
            <p class="text-muted">Наши лучшие реализованные проекты</p>
        </div>
        <div class="row g-4">
            {% for item in latest_portfolio %}
            <div class="col-lg-4 animate-scale delay-{{ forloop.counter }}00">
                <div class="card glass-card-premium h-100 border-0">
                    {% if item.image %}
                        <div class="overflow-hidden">
                            <img src="{{ item.image.url }}" class="card-img-top" alt="{{ item.title }}" style="transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);">
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <span class="badge-category mb-2 d-inline-block" style="background: rgba(58, 123, 213, 0.1); color: var(--color-primary);">{{ item.category.name }}</span>
                        <h5 class="card-title">{{ item.title }}</h5>
                        <p class="card-text small">{{ item.description|striptags|truncatewords:15 }}</p>
                        <a href="{{ item.get_absolute_url }}" class="btn btn-sm btn-glass">Смотреть кейс</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-5 animate-up">
            <a href="{% url 'portfolio:list' %}" class="btn btn-outline-light px-5">Смотреть все работы</a>
        </div>
    </section>
    {% endif %}

    <!-- Свежие новости -->
    {% if recent_news %}
    <section class="home-section">
        <div class="section-title animate-up">
            <h2 class="display-5 text-gradient">Новости и Статьи</h2>
            <p class="text-muted">Будьте в курсе последних событий</p>
        </div>
        <div class="row g-4">
            {% for news in recent_news %}
            <div class="col-md-4 animate-right delay-{{ forloop.counter }}00">
                <div class="glass-card-premium overflow-hidden border-0 h-100">
                    {% if news.image %}
                    <div class="overflow-hidden" style="height: 180px;">
                        <img src="{{ news.image.url }}" class="w-100 h-100" alt="{{ news.title }}" style="object-fit: cover; transition: transform 0.6s ease;">
                    </div>
                    {% endif %}
                    <div class="p-4">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <i class="bi bi-calendar3 me-2 text-primary"></i>
                                <span class="small text-muted">{{ news.news_date|date:"d.m.Y" }}</span>
                            </div>
                            {% if news.category %}
                            <span class="badge bg-primary bg-opacity-25 text-primary small">{{ news.category.name }}</span>
                            {% endif %}
                        </div>
                        <h5 class="h6 mb-3"><a href="{% url 'news:detail' news.slug %}" class="text-white hover-primary">{{ news.title }}</a></h5>
                        <p class="small text-muted mb-4">{{ news.meta_description|default:news.content|striptags|truncatewords:20 }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="{% url 'news:detail' news.slug %}" class="text-primary small text-uppercase fw-bold letter-spacing-1">Подробнее <i class="bi bi-arrow-right"></i></a>
                            <span class="small text-muted"><i class="bi bi-eye me-1"></i>{{ news.views }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-5 animate-up">
            <a href="{% url 'news:list' %}" class="btn btn-outline-light px-5">Все новости <i class="bi bi-arrow-right"></i></a>
        </div>
    </section>
    {% endif %}

    <!-- Отзывы -->
    {% if recent_reviews %}
    <section class="home-section">
        <div class="section-title animate-up">
            <h2 class="display-5 text-gradient">Отзывы клиентов</h2>
            <p class="text-muted">Что говорят наши клиенты о сотрудничестве</p>
        </div>
        <div class="row g-4">
            {% for review in recent_reviews %}
            <div class="col-md-4 animate-up delay-{{ forloop.counter }}00">
                <div class="glass-card-premium p-4 review-card border-0 h-100">
                    <div class="mb-3">
                        <i class="bi bi-quote fs-2 text-primary opacity-50"></i>
                    </div>
                    <p class="fst-italic opacity-75 mb-4">"{{ review.content|truncatewords:30 }}"</p>
                    <div class="d-flex align-items-center mt-auto">
                        <div class="review-avatar me-3" style="width: 45px; height: 45px; background: var(--gradient-premium); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;">
                            <i class="bi bi-person-fill fs-5"></i>
                        </div>
                        <div>
                            <h6 class="mb-0 text-white small fw-bold">{{ review.full_name }}</h6>
                            <small class="text-muted">{{ review.created_at|date:"d.m.Y" }}</small>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-5 animate-up">
            <a href="{% url 'reviews:list' %}" class="btn btn-outline-primary px-5">
                <i class="bi bi-chat-left-quote me-2"></i>Все отзывы
            </a>
        </div>
    </section>
    {% endif %}

    <!-- Статистика для персонала -->
    {% if stats %}
    <section class="home-section animate-scale">
        <div class="glass-card-premium p-5 bg-primary text-white text-center">
            <h3 class="h4 mb-5 fw-bold"><i class="bi bi-graph-up-arrow me-2"></i> Показатели системы</h3>
            <div class="row g-4">
                <div class="col-6 col-md-3">
                    <div class="display-6 fw-bold mb-1">{{ stats.news_count }}</div>
                    <div class="small text-uppercase opacity-75 letter-spacing-1">Новостей</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="display-6 fw-bold mb-1">{{ stats.portfolio_count }}</div>
                    <div class="small text-uppercase opacity-75 letter-spacing-1">Работ</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="display-6 fw-bold mb-1">{{ stats.total_views }}</div>
                    <div class="small text-uppercase opacity-75 letter-spacing-1">Просмотров</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="display-6 fw-bold mb-1">{{ stats.users_count }}</div>
                    <div class="small text-uppercase opacity-75 letter-spacing-1">Аккаунтов</div>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

{% endblock %}

