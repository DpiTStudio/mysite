{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
    .stat-card {
        border: none;
        border-radius: 20px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        overflow: hidden;
        position: relative;
        color: white;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .stat-card:hover {
        transform: translateY(-12px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    .stat-card .card-body {
        padding: 1.8rem;
        z-index: 2;
        position: relative;
    }
    .stat-icon {
        font-size: 4rem;
        opacity: 0.2;
        position: absolute;
        right: -10px;
        bottom: -10px;
        transition: all 0.4s ease;
        z-index: 1;
    }
    .stat-card:hover .stat-icon {
        transform: scale(1.3) rotate(-12deg);
        opacity: 0.4;
    }
    .bg-gradient-primary { background: linear-gradient(45deg, #4e73df 0%, #224abe 100%); }
    .bg-gradient-secondary { background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); }
    .bg-gradient-blue { background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%); }
    .bg-gradient-dark { background: linear-gradient(45deg, #2c3e50 0%, #000000 100%); }
    .bg-gradient-success { background: linear-gradient(45deg, #11998e 0%, #38ef7d 100%); }
    .bg-gradient-info { background: linear-gradient(45deg, #2193b0 0%, #6dd5ed 100%); }
    
    .quick-link-card {
        border-radius: 15px;
        border: 1px solid rgba(0,0,0,0.08);
        background: #fff;
        transition: all 0.3s ease;
        text-decoration: none !important;
        color: #4a5568 !important;
        display: flex;
        align-items: center;
        padding: 1.2rem;
        height: 100%;
    }
    .quick-link-card:hover {
        background: #f8fafc;
        border-color: #4e73df;
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.05);
        color: #224abe !important;
    }
    .quick-link-card i {
        font-size: 1.5rem;
        margin-right: 1rem;
        transition: transform 0.3s ease;
    }
    .quick-link-card:hover i {
        transform: scale(1.2);
    }
    .dashboard-header {
        margin-top: 3rem;
        margin-bottom: 2.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 2px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .dashboard-title {
        font-weight: 800;
        background: linear-gradient(45deg, #2d3748, #4a5568);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
</style>
{% endblock %}

{% block content %}
    <section class="mb-5">
        <div class="site_content">
            {{ site_settings.content|safe }}
        </div>
    </section>

    {% if user.is_staff %}
    <div class="container-fluid dashboard-section px-0">
        <div class="dashboard-header animate__animated animate__fadeIn">
            <h2 class="dashboard-title mb-0"><i class="bi bi-grid-1x2-fill me-2" style="color: #4e73df;"></i> Панель управления CMS</h2>
            <div>
                <a href="/admin/" class="btn btn-primary shadow-sm"><i class="bi bi-cpu-fill me-1"></i> Полная Админ-панель</a>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <!-- Просмотры -->
            <div class="col-xl-3 col-md-6">
                <div class="card stat-card bg-gradient-success h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase small fw-bold opacity-75">Общие просмотры</h6>
                        <h3 class="display-6 fw-bold mb-0">{{ stats.total_views }}</h3>
                        <p class="mb-0 small opacity-75">всего посещений контента</p>
                        <i class="bi bi-eye stat-icon"></i>
                    </div>
                </div>
            </div>

            <!-- Статистика Новости -->
            <div class="col-xl-3 col-md-6">
                <div class="card stat-card bg-gradient-primary h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase small fw-bold opacity-75">Новости</h6>
                        <h3 class="display-6 fw-bold mb-0">{{ stats.news_count }}</h3>
                        <p class="mb-0 small opacity-75">{{ stats.news_categories_count }} категорий</p>
                        <i class="bi bi-newspaper stat-icon"></i>
                    </div>
                </div>
            </div>

            <!-- Статистика Портфолио -->
            <div class="col-xl-3 col-md-6">
                <div class="card stat-card bg-gradient-blue h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase small fw-bold opacity-75">Портфолио</h6>
                        <h3 class="display-6 fw-bold mb-0">{{ stats.portfolio_count }}</h3>
                        <p class="mb-0 small opacity-75">{{ stats.portfolio_categories_count }} категорий</p>
                        <i class="bi bi-briefcase stat-icon"></i>
                    </div>
                </div>
            </div>

            <!-- Статистика Тикеты -->
            <div class="col-xl-3 col-md-6">
                <div class="card stat-card bg-gradient-info h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase small fw-bold opacity-75">Поддержка (Тикеты)</h6>
                        <h3 class="display-6 fw-bold mb-0">{{ stats.tickets_count }}</h3>
                        {% if stats.open_tickets_count > 0 %}
                            <p class="mb-0 small fw-bold text-white"><i class="bi bi-exclamation-triangle-fill me-1"></i> {{ stats.open_tickets_count }} открыто</p>
                        {% else %}
                            <p class="mb-0 small opacity-75">Все заявки закрыты</p>
                        {% endif %}
                        <i class="bi bi-headset stat-icon"></i>
                    </div>
                </div>
            </div>

            <!-- Статистика Отзывы -->
            <div class="col-xl-3 col-md-6">
                <div class="card stat-card bg-gradient-secondary h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase small fw-bold opacity-75">Отзывы пользователей</h6>
                        <h3 class="display-6 fw-bold mb-0">{{ stats.reviews_count }}</h3>
                        {% if stats.pending_reviews_count > 0 %}
                            <div class="mt-1">
                                <span class="badge bg-white text-danger shadow-sm">{{ stats.pending_reviews_count }} на модерации</span>
                            </div>
                        {% else %}
                            <p class="mb-0 small opacity-75 text-white">Новых отзывов нет</p>
                        {% endif %}
                        <i class="bi bi-chat-heart stat-icon"></i>
                    </div>
                </div>
            </div>

            <!-- Статистика Пользователи -->
            <div class="col-xl-3 col-md-6">
                <div class="card stat-card bg-gradient-dark h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase small fw-bold opacity-75">Пользователи</h6>
                        <h3 class="display-6 fw-bold mb-0">{{ stats.users_count }}</h3>
                        <p class="mb-0 small opacity-75">всего в системе</p>
                        <i class="bi bi-people stat-icon"></i>
                    </div>
                </div>
            </div>
            
            <!-- Системные логи -->
            <div class="col-xl-6 col-md-12">
                <a href="/admin/logfiles/logfile/" class="card stat-card h-100 text-decoration-none" style="background: linear-gradient(45deg, #606c88 0%, #3f4c6b 100%);">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <h5 class="card-title fw-bold mb-1">Системные логи и отладка</h5>
                                <p class="mb-0 opacity-75">Просмотр ошибок django.log и управление файлами.</p>
                            </div>
                            <div class="col-4 text-end">
                                <span class="btn btn-sm btn-outline-light px-3 rounded-pill">Логи</span>
                            </div>
                        </div>
                        <i class="bi bi-terminal stat-icon"></i>
                    </div>
                </a>
            </div>

            <!-- История действий -->
            <div class="col-xl-6 col-md-12">
                <a href="/admin/admin/logentry/" class="card stat-card h-100 text-decoration-none" style="background: linear-gradient(45deg, #2c3e50 0%, #4a5568 100%);">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <h5 class="card-title fw-bold mb-1">Подробная история действий</h5>
                                <p class="mb-0 opacity-75">Кто, когда и что изменил на сайте. Полный аудит действий персонала.</p>
                            </div>
                            <div class="col-4 text-end">
                                <span class="btn btn-sm btn-outline-light px-3 rounded-pill">История</span>
                            </div>
                        </div>
                        <i class="bi bi-clock-history stat-icon"></i>
                    </div>
                </a>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <h4 class="mb-4 fw-bold"><i class="bi bi-lightning-charge-fill text-warning me-2"></i> Быстрый доступ к управлению</h4>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/news/news/add/" class="quick-link-card">
                    <i class="bi bi-plus-circle-fill text-primary"></i> <span>Добавить новость</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/portfolio/portfolio/add/" class="quick-link-card">
                    <i class="bi bi-plus-circle-fill text-success"></i> <span>Добавить проект</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/reviews/review/" class="quick-link-card">
                    <i class="bi bi-check-circle-fill text-warning"></i> <span>Модерация отзывов</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/tickets/ticket/" class="quick-link-card">
                    <i class="bi bi-headphones text-info"></i> <span>Управление тикетами</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/main/page/" class="quick-link-card">
                    <i class="bi bi-file-earmark-code-fill text-secondary"></i> <span>Текстовые страницы</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/main/sitesettings/" class="quick-link-card">
                    <i class="bi bi-gear-wide-connected text-dark"></i> <span>Настройки сайта</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/accounts/user/" class="quick-link-card">
                    <i class="bi bi-person-lines-fill text-danger"></i> <span>Все профили</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                <a href="/admin/logfiles/logbackup/" class="quick-link-card">
                    <i class="bi bi-archive-fill text-dark"></i> <span>Бекапы логов</span>
                </a>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}

