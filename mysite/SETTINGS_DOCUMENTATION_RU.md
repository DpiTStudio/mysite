# Документация файла settings.py (DPIT-CMS)

Этот документ содержит подробное описание каждой строки конфигурационного файла проекта Django.

---

### Общая информация и импорты
**Строки 1-11**: Документация в формате строки (docstring), сгенерированная Django. Она содержит ссылки на официальную документацию Django 4.2.
**Строка 13**: `import os` — Импорт модуля `os` для работы с операционной системой (переменные окружения, пути).
**Строка 14**: `from pathlib import Path` — Импорт класса `Path` для удобной работы с путями в файловой системе.

---

### Базовые пути
**Строка 17**: `BASE_DIR = Path(__file__).resolve().parent.parent` — Определение базовой директории проекта. Она вычисляется относительно текущего файла `settings.py` (поднимается на два уровня вверх до корня проекта).

---

### Безопасность и отладка
**Строки 25-28**: `SECRET_KEY = os.environ.get(...)` — Секретный ключ проекта. Сначала пытается получить его из переменной окружения `SECRET_KEY`, если её нет — использует жестко заданное значение (fallback) для разработки.
**Строка 32**: `DEBUG = os.environ.get("DEBUG", "True").lower() in ("true", "1", "yes")` — Настройка режима отладки. Проверяет переменную окружения `DEBUG`. Значение `True` включает подробные сообщения об ошибках.

---

### Хосты и домены
**Строки 36-42**: `ALLOWED_HOSTS = [...]` — Список строк, представляющих имена хостов/доменов, которые может обслуживать этот Django-сайт.
- `"*"`: Разрешает любые хосты (используется для разработки).
- `"dpit-cms.ru"`: Основной домен.
- `"213.171.7.204"`: IP-адрес сервера.
- `"localhost"`, `"127.0.0.1"`: Локальные адреса.

---

### Установленные приложения (INSTALLED_APPS)
**Строки 48-67**: Список всех активных приложений в проекте.
- `jazzmin`: Тема оформления админ-панели.
- `django.contrib.admin`: Стандартная панель администратора.
- `django.contrib.auth`: Система аутентификации.
- `django.contrib.contenttypes`: Система типов контента.
- `django.contrib.sessions`: Управление сессиями.
- `django.contrib.messages`: Система уведомлений.
- `django.contrib.staticfiles`: Управление статическими файлами.
- `django.contrib.sitemaps`: Генерация карты сайта.
- `captcha`: Приложение для защиты форм.
- Приложения проекта: `main`, `news`, `portfolio`, `reviews`, `logfiles`, `accounts`, `tickets`, `mail`, `services`.
- `tinymce`: Визуальный редактор текста.

---

### Промежуточное ПО (MIDDLEWARE)
**Строки 70-77**: Список инструментов, которые обрабатывают запросы и ответы.
- `SecurityMiddleware`: Безопасность (редиректы, заголовки).
- `SessionMiddleware`: Поддержка сессий.
- `CommonMiddleware`: Общие операции (обработка URL, заголовки).
- `CsrfViewMiddleware`: Защита от CSRF-атак.
- `AuthenticationMiddleware`: Привязка пользователя к запросу.
- `MessageMiddleware`: Поддержка временных уведомлений.
- `XFrameOptionsMiddleware`: Защита от кликджекинга.

---

### Конфигурация URL и шаблонов
**Строка 79**: `ROOT_URLCONF = "mysite.urls"` — Путь к файлу с основными маршрутами (URL) проекта.
**Строки 81-99**: Настройка системы шаблонов.
- `BACKEND`: Используемый движок (DjangoTemplates).
- `DIRS`: Список путей к папкам с шаблонами (`templates` в корне проекта).
- `APP_DIRS`: Искать ли шаблоны внутри папок приложений.
- `context_processors`: Функции, добавляющие данные во все шаблоны (пользователь, сообщения, новости и т.д.).

---

### WSGI и база данных
**Строка 101**: `WSGI_APPLICATION = "mysite.wsgi.application"` — Путь к объекту приложения для работы с веб-серверами (WSGI).
**Строки 107-112**: `DATABASES` — Настройки базы данных. Используется SQLite3, файл базы — `db.sqlite3` в корне проекта.

---

### Валидация паролей
**Строки 118-131**: `AUTH_PASSWORD_VALIDATORS` — Список проверок сложности пароля:
- Схожесть с данными пользователя.
- Минимальная длина.
- Распространенные пароли.
- Полностью цифровые пароли.

---

### Интернационализация (Язык и время)
**Строка 137**: `LANGUAGE_CODE = "ru-ru"` — Язык сайта (русский).
**Строка 138**: `TIME_ZONE = "Europe/Moscow"` — Часовой пояс (Московское время).
**Строка 139**: `USE_I18N = True` — Включение системы перевода.
**Строка 140**: `USE_TZ = True` — Использовать часовые пояса для времени в БД.

---

### Статические и медиа файлы
**Строка 150**: `STATIC_URL = "/static/"` — URL-префикс для статических файлов.
**Строка 151**: `STATICFILES_DIRS` — Папки с исходной статикой.
**Строка 152**: `STATIC_ROOT` — Папка, куда соберутся все файлы после команды `collectstatic`.
**Строка 154**: `MEDIA_URL = "/media/"` — URL для загруженных пользователями файлов.
**Строка 155**: `MEDIA_ROOT` — Папка на диске для хранения загруженных файлов.

---

### Системные настройки
**Строка 157**: `DEFAULT_AUTO_FIELD = "django.db.models.BigAutoField"` — Тип поля для автоматических ID (64-битный Integer).
**Строка 160**: `AUTH_USER_MODEL = "accounts.User"` — Указание использовать кастомную модель пользователя.
**Строки 163-165**: Настройки капчи (тип символов, длина 3, время жизни 5 минут).
**Строка 167**: `SECURE_CONTENT_TYPE_NOSNIFF = False` — Отключение заголовка безопасности для корректной работы статики в некоторых окружениях.

---

### Настройки Jazzmin (Админка)
**Строки 170-258**: Глобальные настройки внешнего вида панели администратора.
- Заголовки, логотипы, приветствие.
- `order_with_respect_to`: Порядок отображения приложений в меню.
- `icons`: Иконки FontAwesome для каждого раздела и модели.
- `menu`: Настройка главного навигационного меню слева.

---

### UI Tweaks (Тонкая настройка интерфейса Jazzmin)
**Строки 260-287**: Настройки темной темы, фиксированного меню, стилей кнопок и цветовой схемы.
- `theme`: Используется тема "darkly".
- `sidebar_fixed`: Фиксированная боковая панель.

---

### Безопасность и CSRF
**Строки 291-296**: `CSRF_TRUSTED_ORIGINS` — Список доверенных источников для отправки POST-запросов (домен и локальные адреса).

---

### Конфигурация TinyMCE
**Строки 298-312**: `TINYMCE_DEFAULT_CONFIG` — Настройки визуального редактора.
- Размеры, плагины (картинки, ссылки, списки).
- Панель инструментов (toolbar).
- Язык интерфейса: русский.

---

### Безопасность в Production (SSL/HTTPS)
**Строки 315-322**: Настройки безопасности, которые активируются, если `DEBUG = False`.
- `SECURE_SSL_REDIRECT`: Принудительный редирект на HTTPS.
- `CSRF_COOKIE_SECURE`, `SESSION_COOKIE_SECURE`: Передача кук только по HTTPS.
- `X_FRAME_OPTIONS = "DENY"`: Запрет встраивания сайта во фреймы (защита от Clickjacking).

---

### Логирование (LOGGING)
**Строки 325-379**: Настройка ведения журналов (логов).
- Создаются обработчики для записи в файл (`logs/django.log`) и вывода в консоль.
- Настроены фильтры (скрывать "Broken pipe").
- Формат сообщений: `levelname`, `time`, `module`, `message`.

---

### Кеширование
**Строки 382-391**: `CACHES` — Настройка кэширования в оперативной памяти (LocMemCache). Время жизни по умолчанию — 5 минут.

---

### Автоматизация папок
**Строки 394-396**: Скрипт, который создает папку `logs` в корне проекта при запуске, если она отсутствует.

---

### Настройки почтового сервера (SMTP)
**Строки 404-411**: Настройки для отправки писем через Timeweb.
- `EMAIL_HOST`: smtp.timeweb.ru.
- `EMAIL_PORT`: 465 (с использованием SSL).
- `EMAIL_HOST_USER` / `EMAIL_HOST_PASSWORD`: Данные для авторизации (из переменных окружения).

---

### Настройки IMAP (Для системы тикетов/почты)
**Строки 414-417**: Параметры подключения к почтовому ящику для чтения входящих писем.
