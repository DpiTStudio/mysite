# Документация приложения News

Приложение `news` отвечает за публикацию новостей, статей и автоматическую генерацию событий на сайте.

## Обзор
Это приложение позволяет создавать новости вручную через админку, а также имеет мощную систему **сигналов**, которая автоматически генерирует новостные поводы при добавлении работ в портфолио, публикации отзывов или создании новых страниц. Поддерживает RSS-ленты, поиск и категоризацию.

---

## Описание файлов

### 1. `admin.py`
Настройка административной панели.

**Классы:**
- `NewsCategoryAdmin`: Управление категориями.
    - Особенности: Настройка SEO, изменение шапки (Header) для категории, сортировка.
- `NewsAdmin`: Управление новостями.
    - Особенности: Фильтрация по дате и категории, поиск по контенту, группировка полей (SEO, Дополнительно).

### 2. `apps.py`
Конфигурация приложения.
- `ready()`: Метод переопределен для импорта модуля `news.signals`. Это критически важно для работы автоматической генерации новостей.

### 3. `context_processors.py`
Глобальные данные для шаблонов.
- `latest_news(request)`: Возвращает 3 последние новости и список категорий (с подсчетом кол-ва новостей в каждой). Это позволяет отображать блок "Последние новости" в футере или сайдбаре на любой странице сайта.

### 4. `feeds.py`
Генерация RSS-лент.
- `LatestNewsFeed(Feed)`: Создает XML-ленту последних 20 новостей, доступную по адресу `/news/feed/`.
    - `items()`: Возвращает последние 20 активных новостей.
    - `item_title`, `item_description`, `item_link`: Формируют стандартные элементы RSS-канала.

### 5. `forms.py`
Формы для админки.
- `NewsForm` и `NewsCategoryForm`: Подключают визуальный редактор **TinyMCE** для полей с контентом и описанием, делая редактирование удобным.

### 6. `models.py`
Структура данных.

**Классы:**
- `NewsCategory(ActiveModel, SEOModel, HeaderModel)`: Категория новостей. Наследует настройки шапки сайта, что позволяет каждой категории иметь свой уникальный "Header".
- `News(ActiveModel, SEOModel, TimestampModel)`: Сама новость.
    - `increment_views()`: Метод для потокобезопасного увеличения счетчика просмотров (использует `.update()`, не вызывая сигналы).
- `Comment`: Модель комментариев к новостям (пока базовая реализация).

### 7. `signals.py`
**Ключевой файл автоматизации.** Содержит логику "реакции" на события в других приложениях.

**Функции:**
- `transliterate()`: Вспомогательная функция для генерации slug из заголовков.
- `get_unique_slug(model_class, title)`: Генерирует уникальный URL, добавляя цифры если такой slug уже занят.

**Обработчик `auto_create_news`:**
Подписан на сигнал `post_save`. Срабатывает при сохранении моделей из других приложений:
1. **Portfolio (Портфолио)**:
    - Если создана новая работа -> Создает новость "Добавлена новая работа...".
    - Если обновлена -> "Обновлена информация...".
    - Автоматически создает/находит категорию новостей по имени категории портфолио.
2. **Review (Отзывы)**:
    - Только если статус отзыва стал `approved` (Одобрено).
    - Создает новость "Новый отзыв от...".
    - Категория новостей: "Отзывы".
3. **Page (Страницы)**:
    - Если создана/обновлена страница.
    - Категория новостей: "Страницы".

Важно: Во всех случаях есть проверка на дубликаты (по заголовку и дате), чтобы не создавать спам-новости при частых нажатиях "Сохранить".

### 8. `views.py`
Логика отображения.

**Функции:**
- `get_latest_news()`: Кэшируемая функция (на 5 минут) для получения топа новостей.
- `news_list(request)`: Список всех новостей с пагинацией (9 штук на страницу).
- `news_by_category(request, category_slug)`: Фильтрация новостей по категории.
- `news_search(request)`: Поиск по заголовку, описанию и контенту (`Q` объекты для условий ИЛИ).
- `news_detail(request, slug)`: Страница одной новости. Увеличивает счетчик просмотров при открытии.

### 9. `urls.py`
Маршруты URL.
- `/` -> Список новостей.
- `/search/` -> Поиск.
- `/category/<slug>/` -> Фильтр по категории.
- `/feed/` -> RSS лента.
- `/<slug>/` -> Детальная страница новости.
