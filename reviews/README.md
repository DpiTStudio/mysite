# Приложение Reviews - Система отзывов

## Описание

Приложение `reviews` реализует систему отзывов для сайта. Пользователи могут оставлять отзывы, которые проходят модерацию перед публикацией. Администраторы могут одобрять или отклонять отзывы.

## Основные возможности

- Создание отзывов пользователями
- Модерация отзывов (одобрение/отклонение)
- Отображение только одобренных отзывов на сайте
- Контекстный процессор для отображения последних отзывов на всех страницах
- Простая форма добавления отзыва

---

## Структура файлов

### `models.py` - Модели данных

#### Класс `Review`

Модель отзыва пользователя.

**Поля модели:**

- `full_name` (CharField, max_length=200) - ФИО автора отзыва
- `phone` (CharField, max_length=20) - Телефон автора отзыва
- `email` (EmailField) - Email автора отзыва
- `content` (TextField) - Текст отзыва
- `status` (CharField, max_length=10) - Статус модерации отзыва

**Статусы отзыва:**

- `"pending"` - На модерации (по умолчанию)
- `"approved"` - Одобрено (отображается на сайте)
- `"rejected"` - Отклонено (не отображается на сайте)

**Наследуемые поля:**

От `TimestampModel` (из приложения `main`):
- `created_at` - Дата создания отзыва
- `updated_at` - Дата последнего обновления

**Методы:**

- `__str__()` - Возвращает строку вида "ФИО - дата создания"

**Meta-опции:**

- `verbose_name` = "Отзыв"
- `verbose_name_plural` = "Отзывы"
- `ordering` = ["-created_at"] - Сортировка по дате создания (новые сверху)

---

### `views.py` - Представления (Views)

#### Функция `reviews_list(request)`

Отображает список всех одобренных отзывов.

**Функциональность:**

1. Получает queryset отзывов:
   - Фильтрует только одобренные отзывы (`status="approved"`)
   - Сортирует по дате создания (новые первыми)

2. Рендеринг шаблона:
   - Передает список отзывов в контекст

**Шаблон:** `reviews/list.html`

**URL:** `/reviews/`

---

#### Функция `create_review(request)`

Обрабатывает создание нового отзыва.

**Функциональность:**

1. **Обработка POST-запроса:**
   - Получает данные из формы
   - Создает объект формы `ReviewForm` с данными
   - Валидирует форму
   - Сохраняет отзыв в базу данных (статус по умолчанию: "pending")
   - Показывает сообщение об успехе: "Спасибо за ваш отзыв! Он будет опубликован после модерации."
   - Перенаправляет на страницу списка отзывов

2. **Обработка GET-запроса:**
   - Создает пустую форму
   - Рендерит шаблон с формой

**Шаблон:** `reviews/create.html`

**URL:** `/reviews/create/`

**Особенности:**
- Новые отзывы создаются со статусом "pending" (на модерации)
- Отзывы не отображаются на сайте до одобрения администратором
- После создания отзыва пользователь получает подтверждение

---

### `forms.py` - Формы

#### Класс `ReviewForm`

Форма для создания отзыва. Наследуется от `forms.ModelForm`.

**Поля формы:**

- `full_name` - ФИО автора отзыва
- `phone` - Телефон автора отзыва
- `email` - Email автора отзыва
- `content` - Текст отзыва

**Особенности:**
- Все поля являются обязательными (кроме полей, помеченных как optional в модели)
- Автоматическая валидация полей модели
- Email поле проверяется на корректность формата

---

### `admin.py` - Административный интерфейс

Стандартная регистрация модели `Review` в админ-панели Django.

**Доступные действия:**
- Просмотр списка отзывов
- Редактирование отзывов
- Изменение статуса отзыва (одобрение/отклонение)
- Удаление отзывов

**Рекомендуется настроить:**
- Фильтры по статусу отзыва
- Поиск по ФИО, email, телефону
- Сортировка по дате создания

---

### `urls.py` - URL-маршруты

**Пространство имен:** `reviews`

**Маршруты:**

1. `""` - Список одобренных отзывов (`views.reviews_list`)
2. `"create/"` - Создание нового отзыва (`views.create_review`)

---

### `context_processors.py` - Контекстные процессоры

#### Функция `latest_reviews(request)`

Контекстный процессор, добавляющий последние одобренные отзывы во все шаблоны.

**Возвращает словарь:**

- `latest_reviews` - Последние одобренные отзывы (количество ограничено, например, 3-5)

**Использование:**
Добавлен в `settings.py` в `TEMPLATES['OPTIONS']['context_processors']`, поэтому доступен во всех шаблонах автоматически.

**Функциональность:**

1. Получает queryset отзывов:
   - Фильтрует только одобренные отзывы (`status="approved"`)
   - Сортирует по дате создания (новые первыми)
   - Ограничивает количество (например, первые 3)

2. Возвращает словарь с ключом `latest_reviews`

---

### `apps.py` - Конфигурация приложения

Стандартная конфигурация Django приложения без дополнительных настроек.

---

## Использование

### Добавление отзыва пользователем

1. Перейдите на страницу `/reviews/create/`
2. Заполните форму:
   - ФИО
   - Телефон
   - Email
   - Текст отзыва
3. Нажмите кнопку отправки
4. Отзыв будет сохранен со статусом "На модерации"
5. После одобрения администратором отзыв появится на сайте

### Просмотр отзывов

1. Перейдите на страницу `/reviews/`
2. Вы увидите список всех одобренных отзывов
3. Отзывы отсортированы по дате (новые первыми)

### Модерация отзывов

1. Войдите в админ-панель Django
2. Перейдите в раздел "Reviews" → "Отзывы"
3. Выберите отзыв для модерации
4. Измените статус:
   - "Одобрено" - отзыв будет отображаться на сайте
   - "Отклонено" - отзыв не будет отображаться
5. Сохраните изменения

---

## Интеграция с новостями

При одобрении отзыва (`status == 'approved'`) автоматически создается событие в системе новостей (через сигналы Django из приложения `news`). Событие группируется по датам - все одобренные отзывы за один день попадают в одну новость.

**Тип события:** `review_approved`

**Информация в новости:**
- Заголовок: "Новый отзыв от [ФИО]"
- Описание: Текст отзыва
- Связь с объектом отзыва

---

## Зависимости

- Django
- Приложение `main` (абстрактная модель `TimestampModel`)

---

## Безопасность

- Все отзывы проходят модерацию перед публикацией
- На сайте отображаются только одобренные отзывы
- Email и телефон не отображаются публично (только ФИО и текст отзыва)
- Защита от спама через модерацию

---

## Рекомендации по улучшению

Возможные дополнения:
- Добавление рейтинга (звездочки) к отзывам
- Возможность прикрепления фотографий к отзывам
- Ответы на отзывы от администратора
- Категории отзывов (по продуктам/услугам)
- Пагинация списка отзывов
- Фильтрация и сортировка отзывов
- Email-уведомления администратору о новых отзывах
- Защита от спама (капча, ограничение по IP)

---

## Особенности реализации

### Модерация отзывов

Все новые отзывы создаются со статусом "pending". Это позволяет администраторам проверять отзывы перед публикацией, что важно для защиты от спама и нежелательного контента.

### Отображение только одобренных отзывов

Функция `reviews_list()` и контекстный процессор `latest_reviews()` используют фильтр `status="approved"`, что гарантирует, что на сайте отображаются только проверенные отзывы.

### Интеграция с новостями

Одобрение отзыва автоматически создает событие в системе новостей, что позволяет информировать пользователей о новых отзывах через ленту новостей.

---

## Шаблоны

Приложение использует следующие шаблоны:

- `reviews/list.html` - Список отзывов
- `reviews/create.html` - Форма создания отзыва

Эти шаблоны должны быть созданы в директории `templates/reviews/`.
