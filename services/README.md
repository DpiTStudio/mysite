# Приложение Services - Система услуг

## Описание

Приложение `services` реализует полнофункциональную систему управления услугами. Оно позволяет создавать услуги с подробными описаниями, техническими требованиями, ценами и принимать заказы от пользователей.

## Основные возможности

- Управление услугами с HTML-контентом
- Указание технических требований (HTML/CSS, JavaScript, Python, Java, PHP, React, Vue.js, Angular, мобильная версия, адаптивный дизайн, SEO-оптимизация)
- Гибкая система цен (фиксированная или диапазон)
- Форма заказа услуг
- Управление заказами услуг
- Интеграция с пользователями (для авторизованных пользователей)
- Автоматическое создание новостей при добавлении/обновлении услуг
- RSS-поддержка и SEO-оптимизация

---

## Структура файлов

### `models.py` - Модели данных

#### Константы

**`TECH_CHOICES`** - Список доступных технологий:

- `'html'` - HTML/CSS
- `'js'` - JavaScript
- `'python'` - Python
- `'java'` - Java
- `'php'` - PHP
- `'react'` - React
- `'vue'` - Vue.js
- `'angular'` - Angular
- `'mobile'` - Мобильная версия
- `'adaptive'` - Адаптивный дизайн
- `'seo'` - SEO-оптимизация

---

#### Класс `Service`

Модель услуги. Наследуется от абстрактных моделей `ActiveModel`, `SEOModel`, `TimestampModel` из приложения `main`.

**Поля модели:**

- `title` (CharField, max_length=200) - Название услуги
- `slug` (SlugField, unique=True) - URL-адрес услуги (уникальный)
- `icon` (FileField, optional) - Иконка услуги, загружается в `media/services/icons/`
- `short_description` (TextField, optional) - Краткое описание услуги
- `description` (HTMLField, default="<p>Описание услуги</p>") - Полное HTML-описание услуги
- `technical_requirements` (TextField, optional) - Технические условия (сохраняются через запятую)
- `price_type` (CharField, max_length=10) - Тип цены
  - Выборы:
    - `'fixed'` - Фиксированная цена (по умолчанию)
    - `'range'` - Цена от и до
- `price_fixed` (DecimalField, optional) - Фиксированная цена
- `price_min` (DecimalField, optional) - Минимальная цена (для диапазона)
- `price_max` (DecimalField, optional) - Максимальная цена (для диапазона)
- `currency` (CharField, max_length=10, default="RUB") - Валюта цены
- `order` (IntegerField, default=0) - Порядок сортировки услуг

**Наследуемые поля:**

От `ActiveModel`:
- `is_active` - Активна ли услуга

От `SEOModel`:
- `meta_title` - SEO заголовок
- `meta_keywords` - SEO ключевые слова
- `meta_description` - SEO описание

От `TimestampModel`:
- `created_at` - Дата создания записи
- `updated_at` - Дата последнего обновления

**Методы:**

- `__str__()` - Возвращает название услуги
- `get_tech_requirements_list()` - Возвращает список выбранных технологий (список строк)
  - Парсит строку `technical_requirements`, разбивая по запятой
  - Удаляет пробелы
  - Возвращает список кодов технологий
- `get_tech_requirements_display()` - Возвращает отображаемые названия выбранных технологий
  - Использует `get_tech_requirements_list()` для получения кодов
  - Преобразует коды в читаемые названия через словарь `TECH_CHOICES`
  - Возвращает список названий технологий

**Meta-опции:**

- `verbose_name` = "Услуга"
- `verbose_name_plural` = "Услуги"
- `ordering` = ["order", "title"] - Сортировка сначала по порядку, затем по названию

**Особенности:**
- Поддержка нескольких типов цен (фиксированная или диапазон)
- Хранение технических требований в виде строки через запятую
- Методы для удобного получения списка технологий

---

#### Класс `ServiceOrder`

Модель заказа услуги.

**Поля модели:**

- `service` (ForeignKey, related_name='orders') - Связь с услугой (каскадное удаление)
- `user` (ForeignKey, optional, related_name='service_orders') - Связь с пользователем (опционально, при удалении пользователя устанавливается NULL)
- `full_name` (CharField, max_length=255) - ФИО заказчика
- `phone` (CharField, max_length=50) - Телефон заказчика
- `email` (EmailField) - Email заказчика
- `message` (TextField, optional) - Комментарий к заказу
- `status` (CharField, max_length=20) - Статус заказа

**Статусы заказа:**

- `"new"` - Новый (по умолчанию)
- `"processing"` - В обработке
- `"completed"` - Выполнен
- `"cancelled"` - Отменен

**Наследуемые поля:**

От `TimestampModel`:
- `created_at` - Дата создания заказа
- `updated_at` - Дата последнего обновления

**Методы:**

- `__str__()` - Возвращает строку вида "Заказ [ID] - [название услуги]"

**Meta-опции:**

- `verbose_name` = "Заказ услуги"
- `verbose_name_plural` = "Заказы услуг"
- `ordering` = ["-created_at"] - Сортировка по дате (новые сверху)

**Особенности:**
- Заказы могут быть привязаны к авторизованным пользователям
- Для неавторизованных пользователей поле `user` остается NULL

---

### `views.py` - Представления (Views)

#### Класс `ServiceListView`

Класс-представление на основе `ListView` для отображения списка услуг.

**Настройки:**

- `model` = `Service`
- `template_name` = `'services/list.html'`
- `context_object_name` = `'services'`
- `queryset` = Активные услуги, отсортированные по порядку

**Функциональность:**

1. Автоматически получает список активных услуг
2. Сортирует по полю `order`, затем по названию
3. Передает список в контекст шаблона

**URL:** `/services/`

---

#### Класс `ServiceDetailView`

Класс-представление на основе `DetailView` для отображения детальной страницы услуги.

**Настройки:**

- `model` = `Service`
- `template_name` = `'services/detail.html'`
- `context_object_name` = `'service'`

**Методы:**

- `get_context_data(**kwargs)` - Расширяет контекст шаблона
  - Получает базовый контекст
  - Подготавливает начальные данные для формы заказа (`initial`)
  - Если пользователь авторизован:
    - Автоматически заполняет ФИО (из `first_name` и `last_name` или `username`)
    - Автоматически заполняет email (из профиля пользователя)
    - Автоматически заполняет телефон (если поле есть в профиле)
  - Добавляет форму заказа в контекст

**URL:** `/services/<slug>/`

---

#### Класс `ServiceOrderView`

Класс-представление на основе `View` для обработки заказа услуги.

**Методы:**

- `post(self, request, slug)` - Обрабатывает POST-запрос на создание заказа
  1. Получает услугу по слагу
  2. Создает форму заказа с данными из POST
  3. Валидирует форму
  4. При успехе:
     - Сохраняет заказ, привязанный к услуге
     - Если пользователь авторизован, привязывает заказ к пользователю
     - Показывает сообщение об успехе
     - Перенаправляет на страницу услуги
  5. При ошибке:
     - Показывает сообщение об ошибке
     - Рендерит страницу услуги с формой и ошибками

**URL:** `/services/order/<slug>/`

---

### `forms.py` - Формы

#### Класс `ServiceAdminForm`

Кастомная форма для админки с поддержкой множественного выбора технических требований.

**Особенности:**

- `technical_requirements` - Поле `MultipleChoiceField` с чекбоксами
  - Выборы из `TECH_CHOICES`
  - Виджет: `CheckboxSelectMultiple`
  - Необязательное поле

**Методы:**

- `__init__(*args, **kwargs)` - Инициализация формы
  - Вызывает родительский `__init__`
  - Если редактируется существующая услуга, устанавливает начальные значения чекбоксов
  - Парсит строку `technical_requirements` из объекта

- `save(commit=True)` - Сохранение формы
  - Сохраняет базовые поля через `super().save(commit=False)`
  - Получает выбранные технологии из `cleaned_data`
  - Сохраняет их как строку через запятую в поле `technical_requirements`
  - При `commit=True` сохраняет объект в базу

**Использование:**
Используется в `ServiceAdmin` для удобного выбора технологий в админ-панели.

---

#### Класс `ServiceOrderForm`

Форма для создания заказа услуги.

**Поля:**

- `full_name` - ФИО заказчика (TextInput с CSS классом и плейсхолдером)
- `phone` - Телефон (TextInput)
- `email` - Email (EmailInput)
- `message` - Комментарий к заказу (Textarea с 4 строками)

**Особенности:**
- Все поля имеют CSS классы Bootstrap (`form-control`)
- Все поля имеют плейсхолдеры для удобства пользователя

---

### `admin.py` - Административный интерфейс

#### Класс `ServiceAdmin`

Административный класс для управления услугами.

**Настройки:**

- `form` = `ServiceAdminForm` - Использует кастомную форму с чекбоксами для технологий
- `list_display` - Колонки в списке услуг
- `list_filter` - Фильтры для быстрой фильтрации
- `search_fields` - Поля для поиска
- `prepopulated_fields` - Автозаполнение slug из названия

**Особенности:**
Использует `ServiceAdminForm` для удобного выбора технических требований через чекбоксы.

---

#### Класс `ServiceOrderAdmin`

Административный класс для управления заказами услуг.

**Настройки:**

- `list_display` - Колонки в списке заказов
- `list_filter` - Фильтры (статус, дата, услуга)
- `search_fields` - Поиск по контактным данным
- `list_editable` - Редактируемые колонки (например, статус)

---

### `urls.py` - URL-маршруты

**Пространство имен:** `services`

**Маршруты:**

1. `""` - Список услуг (`ServiceListView`)
2. `"<slug>/"` - Детальная страница услуги (`ServiceDetailView`)
3. `"order/<slug>/"` - Оформление заказа услуги (`ServiceOrderView`, только POST)

---

### `signals.py` - Django Signals

Файл пустой в текущей версии. Зарезервирован для будущих сигналов.

**Примечание:** Автоматическое создание новостей при добавлении/обновлении услуг реализовано через сигналы в приложении `news`.

---

## Использование

### Просмотр услуг

1. Список всех услуг: `/services/`
2. Детальная страница услуги: `/services/<slug>/`

### Заказ услуги

1. Перейдите на страницу услуги `/services/<slug>/`
2. Заполните форму заказа:
   - ФИО (для авторизованных пользователей заполняется автоматически)
   - Телефон
   - Email (для авторизованных пользователей заполняется автоматически)
   - Комментарий (необязательно)
3. Нажмите кнопку отправки
4. Заказ будет создан и доступен в админ-панели

### Администрирование

1. Войдите в админ-панель Django
2. Перейдите в раздел "Services"
3. Управляйте услугами и заказами

**При создании/редактировании услуги:**
- Выберите технические требования через чекбоксы
- Укажите тип цены (фиксированная или диапазон)
- Заполните соответствующие поля цены
- Укажите валюту

---

## Интеграция с новостями

При создании или обновлении услуги автоматически создается событие в системе новостей (через сигналы Django из приложения `news`).

**Тип события:**
- `service_added` - При создании услуги
- `service_updated` - При обновлении услуги

**Информация в новости:**
- Заголовок: "Добавлена/Обновлена услуга: [название]"
- Описание: Включает краткое описание, информацию о цене
- Связь с объектом услуги
- Изображение: Иконка услуги (если есть)

**При создании нового заказа:**
- Тип события: `service_order_new` (или `other`)
- Информация о клиенте и услуге

---

## Зависимости

- Django
- django-tinymce (для HTML-редактора)
- Приложение `main` (абстрактные модели)
- Приложение `accounts` (модель `User`)

---

## Особенности

### Хранение технических требований

Технические требования хранятся в виде строки через запятую (например: "html,python,react"). Это позволяет легко добавлять/удалять технологии без изменения структуры базы данных.

### Гибкая система цен

Услуги могут иметь:
- Фиксированную цену (`price_type='fixed'`, заполняется `price_fixed`)
- Диапазон цен (`price_type='range'`, заполняются `price_min` и `price_max`)

### Автозаполнение формы для авторизованных пользователей

При оформлении заказа авторизованными пользователями форма автоматически заполняется данными из их профиля.

---

## Рекомендации по улучшению

Возможные дополнения:
- Фильтрация услуг по техническим требованиям
- Сравнение услуг
- Отзывы на услуги
- История заказов для авторизованных пользователей
- Email-уведомления при создании заказа
- Календарь доступности услуг
- Интеграция с платежными системами

---

## SEO

- Поддержка SEO полей (title, keywords, description)
- Уникальные slug для каждой услуги
- SEO-оптимизированные URL
