{% if cart %}
<div class="cart-items mt-3">
    {% for item in cart %}
    {% with obj=item.item_obj type=item.item_type %}
    <div class="d-flex align-items-center mb-3 pb-3 border-bottom border-secondary border-opacity-25">
        {% if type == 'service' %}
            {% if obj.icon %}
            <img src="{{ obj.icon.url }}" alt="{{ obj.title }}" class="rounded shadow-sm me-3" style="width: 60px; height: 60px; object-fit: cover;">
            {% else %}
            <div class="bg-secondary bg-opacity-25 rounded d-flex align-items-center justify-content-center me-3 shadow-sm" style="width: 60px; height: 60px;">
                <i class="bi bi-gear text-primary fs-4"></i>
            </div>
            {% endif %}
        {% else %}
            {% if obj.image %}
            <img src="{{ obj.image.url }}" alt="{{ obj.title }}" class="rounded shadow-sm me-3" style="width: 60px; height: 60px; object-fit: cover;">
            {% else %}
            <div class="bg-secondary bg-opacity-25 rounded d-flex align-items-center justify-content-center me-3 shadow-sm" style="width: 60px; height: 60px;">
                <i class="bi bi-briefcase text-primary fs-4"></i>
            </div>
            {% endif %}
        {% endif %}
        
        <div class="flex-grow-1">
            <h6 class="mb-1 text-white fw-bold">{{ obj.title }}</h6>
            <div class="d-flex justify-content-between align-items-center mt-2">
                <span class="text-muted small">{{ item.quantity }} × {{ item.price }} ₽</span>
                <span class="text-primary fw-bold">{{ item.total_price }} ₽</span>
            </div>
        </div>
        
        <a href="#" hx-post="{% url 'cart:cart_remove' type obj.id %}" hx-target="#cart-offcanvas-body" hx-swap="innerHTML" class="btn btn-sm btn-outline-danger ms-3 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 35px; height: 35px;" aria-label="Удалить">
            <i class="bi bi-trash"></i>
        </a>
    </div>
    {% endwith %}
    {% endfor %}
</div>

<div class="cart-summary mt-4 pt-2">
    <div class="d-flex justify-content-between mb-4 fs-5">
        <span class="text-muted">Итого:</span>
        <span class="text-white fw-bold">{{ cart.get_total_price }} ₽</span>
    </div>
    
    <div class="d-grid gap-2">
        <a href="{% url 'cart:cart_detail' %}" class="btn btn-outline-light btn-lg rounded-pill">
            Перейти в корзину
        </a>
        <a href="#" class="btn btn-primary btn-lg rounded-pill shadow-glow shine-effect">
            Оформить заказ
        </a>
    </div>
</div>
{% else %}
<div class="text-center py-5">
    <div class="display-4 text-muted mb-3 opacity-50">
        <i class="bi bi-cart-x"></i>
    </div>
    <h5 class="text-white mb-3">Корзина пуста</h5>
    <p class="text-muted small mb-4">Выберите услуги в нашем каталоге, чтобы добавить их сюда.</p>
    <a href="{% url 'services:list' %}" class="btn btn-primary rounded-pill px-4">
        В каталог услуг
    </a>
</div>
{% endif %}

<!-- HTMX OOB Updates -->
<span id="header-cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger {% if cart|length == 0 %}d-none{% endif %}" hx-swap-oob="true">
    {{ cart|length }}
    <span class="visually-hidden">товаров в корзине</span>
</span>
<span id="cart-offcanvas-count" class="badge bg-danger rounded-pill" hx-swap-oob="true">{{ cart|length }}</span>
