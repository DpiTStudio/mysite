# Документация приложения Tickets

Приложение `tickets` реализует систему технической поддержки (Helpdesk). Позволяет пользователям создавать обращения (тиккеты), а администраторам — отвечать на них.

## Обзор
Приложение предоставляет полный цикл работы с заявками: от создания до закрытия. Пользователи могут общаться с поддержкой в режиме чата внутри каждого тикета. Персонал сайта видит все заявки, обычные пользователи — только свои. Поддерживаются статусы и приоритеты.

---

## Описание файлов

### 1. `admin.py`
Настройка административной панели.
- `TicketAdmin`: Управление тикетами. Включает фильтрацию по статусу и приоритету.
- `TicketMessageAdmin`: Просмотр всех сообщений в системе.

### 2. `forms.py`
Формы приложения.
- `TicketForm`: Форма создания нового обращения.
    - Включает тему, описание и приоритет.
    - Защищена капчей (`CaptchaField`).
- `TicketMessageForm`: Форма для отправки сообщения (ответа) в существующем тикете.

### 3. `models.py`
Структура данных.

**Классы/Enums:**
- `TicketStatus`: Статусы заявки (Открыт, В работе, Решен, Закрыт).
- `TicketPriority`: Приоритет (Низкий, Средний, Высокий, Срочный).

**Модели:**
- `Ticket(TimestampModel)`: Сама заявка.
    - Связана с пользователем (`User`).
    - Хранит тему, статус, приоритет и дату закрытия (`closed_at`).
- `TicketMessage(TimestampModel)`: Сообщение внутри переписки.
    - `is_internal`: Флаг для "внутренних" комментариев администраторов (пока не используется в публичном интерфейсе, но заложен в архитектуру).

### 4. `views.py`
Логика.
Все представления защищены декоратором `@login_required` (доступны только авторизованным).

**Функции:**
- `ticket_list(request)`: Список тикетов.
    - **Персонал (`is_staff`):** Видит ВСЕ тикеты всех пользователей.
    - **Обычные пользователи:** Видят только СВОИ тикеты.
    - Поддерживает фильтрацию по статусу через GET-параметры.
- `ticket_create(request)`: Создание заявки.
- `ticket_detail(request, ticket_id)`: Чат тикета.
    - При отправке нового сообщения в ЗАКРЫТЫЙ тикет, он автоматически переоткрывается (`status` -> `TicketStatus.OPEN`).
- `ticket_close(request, ticket_id)`: Действие для закрытия тикета. Устанавливает статус "Закрыт" и текущее время.

### 5. `urls.py`
Маршруты URL.
- `/` -> Список тикетов.
- `/create/` -> Создать новый.
- `/<id>/` -> Просмотр переписки.
- `/<id>/close/` -> Закрыть тикет.
